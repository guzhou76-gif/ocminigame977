<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>槿天华 · 小公司养成模拟器</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .game-wrapper {
      width: 100%;
      max-width: 480px;
      padding: 12px;
    }

    .card {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(148,163,184,0.6);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      background: radial-gradient(circle at 10% 0%, rgba(96,165,250,0.5) 0, transparent 55%),
                  radial-gradient(circle at 90% 100%, rgba(244,114,182,0.4) 0, transparent 60%),
                  #020617;
    }

    .bg-layer {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      opacity: 0.35;
      filter: blur(4px);
      transform: scale(1.05);
    }

    .content-layer {
      position: relative;
      padding: 10px;
      backdrop-filter: blur(4px);
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }
    .title {
      font-size: 16px;
      font-weight: 600;
    }
    .subtitle {
      font-size: 11px;
      color: #cbd5f5;
    }

    .badge-row {
      display: flex;
      gap: 6px;
      margin-top: 2px;
      flex-wrap: wrap;
    }
    .badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.9);
      background: rgba(15,23,42,0.8);
      color: #e5e7eb;
    }

    .sprite-area {
      margin-top: 6px;
      border-radius: 14px;
      background: rgba(15,23,42,0.8);
      display: flex;
      align-items: center;
      padding: 6px;
      gap: 8px;
    }

    .sprite-box {
      width: 140px;
      aspect-ratio: 3/4;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(148,163,184,0.7);
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .sprite-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .stat-box {
      flex: 1;
      font-size: 12px;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stat-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .stat-label {
      font-size: 11px;
      color: #cbd5f5;
      white-space: nowrap;
    }

    .stat-bar {
      flex: 1;
      height: 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      overflow: hidden;
    }
    .stat-bar-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, #38bdf8, #a855f7);
      width: 50%;
      transition: width 0.2s ease-out;
    }

    .stat-value {
      font-size: 11px;
      width: 42px;
      text-align: right;
      color: #e5e7eb;
    }

    .money-favor {
      display: flex;
      gap: 6px;
      font-size: 11px;
      margin-top: 4px;
    }
    .pill {
      flex: 1;
      border-radius: 999px;
      padding: 4px 8px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.9);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tabs {
      margin-top: 8px;
      display: flex;
      gap: 4px;
      font-size: 11px;
    }
    .tab-btn {
      flex: 1;
      padding: 6px 4px;
      border-radius: 999px;
      border: none;
      background: rgba(15,23,42,0.85);
      color: #e5e7eb;
      cursor: pointer;
      border: 1px solid transparent;
    }
    .tab-btn.active {
      border-color: rgba(129,140,248,0.95);
      background: rgba(30,64,175,0.9);
    }

    .panel {
      margin-top: 8px;
      font-size: 12px;
      border-radius: 12px;
      background: rgba(15,23,42,0.85);
      padding: 8px;
      min-height: 110px;
    }

    .actions-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }
    .action-btn {
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.9);
      background: rgba(15,23,42,0.95);
      color: #e5e7eb;
      padding: 6px;
      text-align: left;
      cursor: pointer;
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .action-btn strong {
      font-size: 12px;
    }
    .action-desc {
      color: #9ca3af;
      font-size: 11px;
    }

    .log {
      font-size: 11px;
      color: #cbd5f5;
      margin-top: 4px;
      max-height: 70px;
      overflow-y: auto;
      padding-right: 4px;
      white-space: pre-wrap;
    }

    .gacha-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .gacha-cost {
      font-size: 11px;
      color: #e5e7eb;
    }
    .gacha-btn {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      border: none;
      background: linear-gradient(90deg,#6366f1,#ec4899);
      color: #f9fafb;
      cursor: pointer;
    }

    .gacha-result {
      font-size: 12px;
      color: #e5e7eb;
      margin-top: 4px;
    }
    .rarity-r {
      color: #a5b4fc;
    }
    .rarity-sr {
      color: #f97316;
    }
    .rarity-ssr {
      color: #facc15;
      text-shadow: 0 0 6px rgba(250,204,21,0.7);
    }

    .inventory-list {
      margin-top: 6px;
      font-size: 11px;
      color: #9ca3af;
      max-height: 70px;
      overflow-y: auto;
    }

    .footer {
      margin-top: 4px;
      font-size: 10px;
      color: #9ca3af;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="card">
      <!-- 背景图：这里先用占位路径，之后你换成自己的 -->
      <div class="bg-layer" id="bgLayer"
           style="background-image:url('images/bg_office_day.jpg');"></div>

      <div class="content-layer">
        <!-- 顶部信息 -->
        <div class="header">
          <div>
            <div class="title">槿天华的小公司日常</div>
            <div class="subtitle">轻松办公 · 摸鱼养成 · 偶尔抽卡</div>
            <div class="badge-row">
              <div class="badge">桌宠 / 网页小游戏</div>
              <div class="badge">本地存档 · 单机</div>
            </div>
          </div>
        </div>

        <!-- 角色区域 -->
        <div class="sprite-area">
          <div class="sprite-box">
            <!-- 立绘占位：之后换成槿天华的图，如 images/jth_normal.png -->
            <img id="spriteImg" src="images/jth_normal.png" alt="槿天华">
          </div>
          <div class="stat-box">
            <div class="stat-row">
              <div class="stat-label">心情 Mood</div>
              <div class="stat-bar"><div id="moodBar" class="stat-bar-fill"></div></div>
              <div id="moodText" class="stat-value"></div>
            </div>
            <div class="stat-row">
              <div class="stat-label">精力 Energy</div>
              <div class="stat-bar"><div id="energyBar" class="stat-bar-fill"></div></div>
              <div id="energyText" class="stat-value"></div>
            </div>
            <div class="stat-row">
              <div class="stat-label">好感 Favor</div>
              <div class="stat-bar"><div id="favorBar" class="stat-bar-fill"></div></div>
              <div id="favorText" class="stat-value"></div>
            </div>
            <div class="money-favor">
              <div class="pill">
                <span>公司资金</span>
                <span id="moneyText">¥0</span>
              </div>
              <div class="pill">
                <span>今日标签</span>
                <span id="statusTag">初始上班日</span>
              </div>
            </div>
          </div>
        </div>

        <!-- 选项卡 -->
        <div class="tabs">
          <button class="tab-btn active" data-tab="daily">日常</button>
          <button class="tab-btn" data-tab="work">工作</button>
          <button class="tab-btn" data-tab="gacha">抽卡</button>
        </div>

        <!-- 面板：日常 -->
        <div class="panel" id="panel-daily">
          <div class="actions-grid">
            <button class="action-btn" data-action="chat">
              <strong>聊聊天</strong>
              <div class="action-desc">和槿天华随便说说今天的破事。</div>
            </button>
            <button class="action-btn" data-action="relax">
              <strong>摸鱼休息</strong>
              <div class="action-desc">刷手机 / 看猫片，恢复心情与精力。</div>
            </button>
            <button class="action-btn" data-action="coffee">
              <strong>咖啡续命</strong>
              <div class="action-desc">精力回一点，心情看咖啡味道。</div>
            </button>
            <button class="action-btn" data-action="night">
              <strong>切换昼夜</strong>
              <div class="action-desc">换个背景图，假装是加班还是下班。</div>
            </button>
          </div>
          <div class="log" id="logBox"></div>
        </div>

        <!-- 面板：工作 -->
        <div class="panel" id="panel-work" style="display:none;">
          <div class="actions-grid">
            <button class="action-btn" data-action="workHard">
              <strong>认真工作</strong>
              <div class="action-desc">赚更多钱，但会掉不少精力和心情。</div>
            </button>
            <button class="action-btn" data-action="lightWork">
              <strong>划水办公</strong>
              <div class="action-desc">赚少一点钱，但没那么累。</div>
            </button>
            <button class="action-btn" data-action="report">
              <strong>写周报</strong>
              <div class="action-desc">好感略涨，心情略降（经典矛盾）。</div>
            </button>
            <button class="action-btn" data-action="meeting">
              <strong>开会</strong>
              <div class="action-desc">随机事件：有时涨好感，有时全员-心情。</div>
            </button>
          </div>
          <div class="log" id="workLogBox"></div>
        </div>

        <!-- 面板：抽卡 -->
        <div class="panel" id="panel-gacha" style="display:none;">
          <div class="gacha-top">
            <div class="gacha-cost">单抽：¥50，公司资金不足将无法抽卡</div>
            <button class="gacha-btn" id="gachaBtn">单抽 x1</button>
          </div>
          <div id="gachaResult" class="gacha-result">还没有抽到任何东西。</div>
          <div class="inventory-list" id="inventoryList">
            当前持有：暂无卡片。
          </div>
        </div>

        <div class="footer">
          本地存档 · 关闭页面数据不会丢失
        </div>
      </div>
    </div>
  </div>

  <script>
    // —— 游戏状态（会存到 localStorage） ——
    const DEFAULT_STATE = {
      mood: 70,
      energy: 70,
      favor: 30,
      money: 200,
      dayMode: "day", // day / night
      statusTag: "初始上班日",
      inventory: [] // 存抽卡获得的id
    };

    let state = loadState();

    // —— 抽卡卡池设定（你可以之后改成更贴合槿天华的） ——
    const GACHA_POOL = [
      { id: "desk_cat",   name: "桌上路过的小猫",         rarity: "R",   type: "event", desc: "心情+5，今天办公区突然多了一只猫。" },
      { id: "milk_tea",   name: "加珍珠奶茶券",           rarity: "R",   type: "item",  desc: "解锁特别摸鱼台词。（只是设定文案）" },
      { id: "rainy_bg",   name: "雨天窗边背景",           rarity: "SR",  type: "bg",    desc: "解锁一种新的背景氛围。" },
      { id: "chibi_skin", name: "Q版槿天华立绘",         rarity: "SR",  type: "skin",  desc: "可以切换成Q版形象显示。" },
      { id: "ssr_event",  name: "SS级甲方表扬邮件",       rarity: "SSR", type: "event", desc: "心情+20，钱+100，但总感觉哪儿不太对劲。" }
    ];

    // —— DOM 元素引用 ——
    const moodBar    = document.getElementById("moodBar");
    const moodText   = document.getElementById("moodText");
    const energyBar  = document.getElementById("energyBar");
    const energyText = document.getElementById("energyText");
    const favorBar   = document.getElementById("favorBar");
    const favorText  = document.getElementById("favorText");
    const moneyText  = document.getElementById("moneyText");
    const statusTag  = document.getElementById("statusTag");
    const spriteImg  = document.getElementById("spriteImg");
    const bgLayer    = document.getElementById("bgLayer");

    const logBox      = document.getElementById("logBox");
    const workLogBox  = document.getElementById("workLogBox");
    const gachaBtn    = document.getElementById("gachaBtn");
    const gachaResult = document.getElementById("gachaResult");
    const inventoryList = document.getElementById("inventoryList");

    const tabButtons = document.querySelectorAll(".tab-btn");
    const panels = {
      daily: document.getElementById("panel-daily"),
      work: document.getElementById("panel-work"),
      gacha: document.getElementById("panel-gacha")
    };

    // —— 初始化 UI ——
    updateAllUI();
    updateInventoryList();
    updateSpriteByInventory();

    // —— tab 切换 ——
    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const tab = btn.dataset.tab;
        tabButtons.forEach(b => b.classList.toggle("active", b === btn));
        Object.keys(panels).forEach(key => {
          panels[key].style.display = (key === tab) ? "block" : "none";
        });
      });
    });

    // —— 日常 & 工作按钮处理 ——
    document.querySelectorAll(".action-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const action = btn.dataset.action;
        handleAction(action);
      });
    });

    // —— 抽卡按钮 ——
    gachaBtn.addEventListener("click", handleGacha);

    // —— 处理各种操作 —— 
    function handleAction(action) {
      switch (action) {
        case "chat":
          changeStat("mood", +5);
          changeStat("favor", +3);
          appendLog(logBox, "你和槿天华聊了会天，他吐槽了两句职场，心情似乎好了一点。");
          setStatus("普通对话日");
          break;
        case "relax":
          changeStat("mood", +8);
          changeStat("energy", +5);
          changeStat("money", -5);
          appendLog(logBox, "你们一起摸鱼刷短视频，时间被吃掉了一点，公司资金小幅缩水。");
          setStatus("摸鱼进行中");
          break;
        case "coffee":
          changeStat("energy", +10);
          // 心情随机上下
          const moodDelta = (Math.random() < 0.7) ? +3 : -2;
          changeStat("mood", moodDelta);
          appendLog(logBox, `咖啡续命完成，精力+10，心情${moodDelta >= 0 ? "+" + moodDelta : moodDelta}。`);
          setStatus("咖啡时间");
          break;
        case "night":
          toggleDayNight();
          break;
        case "workHard":
          changeStat("money", +40);
          changeStat("energy", -15);
          changeStat("mood", -10);
          appendLog(workLogBox, "槿天华认真加班了一大轮，项目推进飞快，但精神状态略显危险。");
          setStatus("高强度加班日");
          break;
        case "lightWork":
          changeStat("money", +20);
          changeStat("energy", -8);
          changeStat("mood", -3);
          appendLog(workLogBox, "今天以划水为主，偶尔认真，勉强算完成 KPI。");
          setStatus("安全摸鱼日");
          break;
        case "report":
          changeStat("favor", +5);
          changeStat("mood", -4);
          appendLog(workLogBox, "你帮忙润色了周报，他看起来有点感动，不过想到周一早会又略微崩溃。");
          setStatus("周报战士");
          break;
        case "meeting":
          const good = Math.random() < 0.5;
          if (good) {
            changeStat("mood", +6);
            changeStat("favor", +4);
            appendLog(workLogBox, "会议出奇地顺利，甲方没有乱提需求，堪称奇迹。");
            setStatus("会议奇迹日");
          } else {
            changeStat("mood", -10);
            changeStat("energy", -6);
            appendLog(workLogBox, "会议开成了吐槽大会和需求炸弹现场，所有人心情-10。");
            setStatus("会议灾难日");
          }
          break;
        default:
          break;
      }
      saveState();
      updateAllUI();
    }

    function toggleDayNight() {
      if (state.dayMode === "day") {
        state.dayMode = "night";
        bgLayer.style.backgroundImage = "url('images/bg_office_night.jpg')";
        appendLog(logBox, "灯光暗了下来，办公室变成夜间模式。加班の气息。");
        setStatus("夜间办公");
      } else {
        state.dayMode = "day";
        bgLayer.style.backgroundImage = "url('images/bg_office_day.jpg')";
        appendLog(logBox, "窗外亮了起来，仿佛一切都还来得及。");
        setStatus("白天工作");
      }
      saveState();
    }

    // —— 抽卡逻辑 —— 
    function handleGacha() {
      const cost = 50;
      if (state.money < cost) {
        gachaResult.textContent = "资金不足，槿天华看了看账本，摇头叹气。";
        return;
      }
      state.money -= cost;

      // 简单概率：SSR 5%，SR 20%，R 75%
      const rand = Math.random();
      let rarity;
      if (rand < 0.05) rarity = "SSR";
      else if (rand < 0.25) rarity = "SR";
      else rarity = "R";

      const candidates = GACHA_POOL.filter(c => c.rarity === rarity);
      const picked = candidates[Math.floor(Math.random() * candidates.length)];

      if (!state.inventory.includes(picked.id)) {
        state.inventory.push(picked.id);
      }

      let rarityClass = "rarity-r";
      if (rarity === "SR") rarityClass = "rarity-sr";
      if (rarity === "SSR") rarityClass = "rarity-ssr";

      gachaResult.innerHTML =
        `抽到卡片：<span class="${rarityClass}">[${rarity}] ${picked.name}</span><br>${picked.desc}`;

      setStatus("抽卡成瘾中");
      appendLog(logBox, `抽到了：${picked.name} (${rarity})`);

      updateInventoryList();
      updateSpriteByInventory();
      saveState();
      updateAllUI();
    }

    function updateInventoryList() {
      if (!state.inventory || state.inventory.length === 0) {
        inventoryList.textContent = "当前持有：暂无卡片。";
        return;
      }
      const lines = state.inventory.map(id => {
        const card = GACHA_POOL.find(c => c.id === id);
        if (!card) return id;
        return `[${card.rarity}] ${card.name}`;
      });
      inventoryList.textContent = "当前持有：\n" + lines.join("\n");
    }

    function updateSpriteByInventory() {
      // 如果抽到 chibi_skin，就换立绘（前提是你有对应的图片）
      if (state.inventory.includes("chibi_skin")) {
        spriteImg.src = "images/jth_chibi.png"; // 之后放你自己的Q版图
      } else {
        spriteImg.src = "images/jth_normal.png";
      }

      // 根据背景卡切换氛围（你也可以扩展）
      if (state.inventory.includes("rainy_bg") && state.dayMode === "day") {
        bgLayer.style.backgroundImage = "url('images/bg_office_rainy.jpg')";
      } else {
        bgLayer.style.backgroundImage =
          state.dayMode === "day"
            ? "url('images/bg_office_day.jpg')"
            : "url('images/bg_office_night.jpg')";
      }
    }

    // —— 通用工具函数 —— 
    function clamp(v, min, max) {
      return Math.max(min, Math.min(max, v));
    }

    function changeStat(key, delta) {
      if (!(key in state)) return;
      if (key === "money") {
        state.money = Math.max(0, state.money + delta);
      } else {
        state[key] = clamp(state[key] + delta, 0, 100);
      }
    }

    function setStatus(text) {
      state.statusTag = text;
    }

    function appendLog(box, text) {
      const now = new Date();
      const time = now.toTimeString().slice(0,5);
      const line = `[${time}] ${text}`;
      if (!box.textContent) {
        box.textContent = line;
      } else {
        box.textContent = box.textContent + "\n" + line;
      }
      box.scrollTop = box.scrollHeight;
    }

    function updateAllUI() {
      moodBar.style.width   = state.mood   + "%";
      energyBar.style.width = state.energy + "%";
      favorBar.style.width  = state.favor  + "%";

      moodText.textContent   = state.mood   + "/100";
      energyText.textContent = state.energy + "/100";
      favorText.textContent  = state.favor  + "/100";

      moneyText.textContent = "¥" + state.money;
      statusTag.textContent = state.statusTag;

      // 确认背景跟状态一致
      updateSpriteByInventory();
    }

    function loadState() {
      try {
        const raw = localStorage.getItem("jth_company_state");
        if (!raw) return { ...DEFAULT_STATE };
        const parsed = JSON.parse(raw);
        return { ...DEFAULT_STATE, ...parsed };
      } catch (e) {
        return { ...DEFAULT_STATE };
      }
    }

    function saveState() {
      localStorage.setItem("jth_company_state", JSON.stringify(state));
    }
  </script>
</body>
</html>
